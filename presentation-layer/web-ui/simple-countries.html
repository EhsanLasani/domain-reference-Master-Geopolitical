<!DOCTYPE html>
<html>
<head>
    <title>Countries - LASANI Platform</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        table { border-collapse: collapse; width: 100%; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
        .btn { padding: 8px 16px; margin: 5px; background: #007cba; color: white; border: none; cursor: pointer; }
        .btn:hover { background: #005a87; }
        .status-active { color: green; font-weight: bold; }
        .status-inactive { color: red; }
    </style>
</head>
<body>
    <h1>LASANI Countries Management</h1>
    
    <div>
        <button class="btn" onclick="loadCountries()">Refresh</button>
        <button class="btn" onclick="addCountry()">Add Country</button>
        <span id="status">Ready</span>
    </div>
    
    <table id="countriesTable">
        <thead>
            <tr>
                <th>Code</th>
                <th>Name</th>
                <th>ISO3</th>
                <th>Capital</th>
                <th>Continent</th>
                <th>Status</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody id="tableBody">
            <tr><td colspan="7">Loading...</td></tr>
        </tbody>
    </table>

    <script>
        let countries = [];

        async function loadCountries() {
            try {
                document.getElementById('status').textContent = 'Loading...';
                const response = await fetch('/api/v1/countries');
                const data = await response.json();
                
                countries = data.countries || [];
                renderTable();
                document.getElementById('status').textContent = `Loaded ${countries.length} countries`;
            } catch (error) {
                document.getElementById('status').textContent = 'Error: ' + error.message;
                console.error('Error:', error);
            }
        }

        function renderTable() {
            const tbody = document.getElementById('tableBody');
            tbody.innerHTML = '';
            
            if (countries.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7">No countries found</td></tr>';
                return;
            }

            countries.forEach((country, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${country.country_code || ''}</td>
                    <td>${country.country_name || ''}</td>
                    <td>${country.iso3_code || ''}</td>
                    <td>${country.capital_city || ''}</td>
                    <td>${country.continent_code || ''}</td>
                    <td class="${country.is_active ? 'status-active' : 'status-inactive'}">
                        ${country.is_active ? 'Active' : 'Inactive'}
                    </td>
                    <td>
                        <button class="btn" onclick="editCountry(${index})">Edit</button>
                        <button class="btn" onclick="deleteCountry('${country.country_code}')">Delete</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function addCountry() {
            const code = prompt('Country Code (2 letters):');
            const name = prompt('Country Name:');
            
            if (code && name) {
                createCountry({
                    country_code: code.toUpperCase(),
                    country_name: name,
                    is_active: true
                });
            }
        }

        async function createCountry(country) {
            try {
                const response = await fetch('/api/v1/countries', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(country)
                });
                
                if (response.ok) {
                    loadCountries();
                    document.getElementById('status').textContent = 'Country created successfully';
                } else {
                    document.getElementById('status').textContent = 'Error creating country';
                }
            } catch (error) {
                document.getElementById('status').textContent = 'Error: ' + error.message;
            }
        }

        function editCountry(index) {
            const country = countries[index];
            const newName = prompt('Country Name:', country.country_name);
            
            if (newName && newName !== country.country_name) {
                country.country_name = newName;
                updateCountry(country);
            }
        }

        async function updateCountry(country) {
            try {
                const response = await fetch(`/api/v1/countries/${country.country_code}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(country)
                });
                
                if (response.ok) {
                    loadCountries();
                    document.getElementById('status').textContent = 'Country updated successfully';
                } else {
                    document.getElementById('status').textContent = 'Error updating country';
                }
            } catch (error) {
                document.getElementById('status').textContent = 'Error: ' + error.message;
            }
        }

        async function deleteCountry(code) {
            if (confirm(`Delete country ${code}?`)) {
                try {
                    const response = await fetch(`/api/v1/countries/${code}`, {
                        method: 'DELETE'
                    });
                    
                    if (response.ok) {
                        loadCountries();
                        document.getElementById('status').textContent = 'Country deleted successfully';
                    } else {
                        document.getElementById('status').textContent = 'Error deleting country';
                    }
                } catch (error) {
                    document.getElementById('status').textContent = 'Error: ' + error.message;
                }
            }
        }

        // Load countries on page load
        loadCountries();
    </script>
</body>
</html>